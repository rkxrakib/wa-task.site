<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Money4U - Firebase</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family:sans-serif; }
        body { background:#f4f7fe; padding-bottom:70px; }
        .header { background:#6f42c1; color:white; padding:30px; text-align:center; border-radius:0 0 20px 20px; }
        .container { padding:20px; }
        .card { background:white; padding:20px; border-radius:15px; box-shadow:0 5px 15px rgba(0,0,0,0.05); margin-bottom:15px; }
        input { width:100%; padding:12px; margin:10px 0; border:1px solid #ddd; border-radius:8px; }
        button { width:100%; padding:12px; background:#6f42c1; color:white; border:none; border-radius:8px; cursor:pointer; font-weight:bold; }
        .pairing-code { font-size:28px; color:red; font-weight:bold; text-align:center; margin-top:15px; }
        .tab-content { display:none; }
        .active { display:block; }
        .nav { position:fixed; bottom:0; width:100%; background:white; display:flex; padding:15px; border-top:1px solid #eee; }
        .nav div { flex:1; text-align:center; font-size:12px; cursor:pointer; }
    </style>
</head>
<body>

<div id="auth-page" class="container">
    <div class="header"><h2>Money4U Platform</h2></div>
    <div class="card" style="margin-top:20px;">
        <input id="phone" type="text" placeholder="Phone Number">
        <input id="pass" type="password" placeholder="Password">
        <button onclick="register()">Register Now</button>
        <button onclick="login()" style="background:#25d366; margin-top:10px;">Login</button>
    </div>
</div>

<div id="home-page" class="tab-content container">
    <div class="header">
        <h3 id="u-phone">User</h3>
        <p>Balance: <span id="u-balance">0.00</span></p>
    </div>
    <div class="card" style="margin-top:20px;" onclick="showTab('task-page')">
        <h4>WhatsApp Message Task</h4>
        <button style="margin-top:10px; background:#25d366;">Start Task</button>
    </div>
</div>

<div id="task-page" class="tab-content container">
    <div class="card">
        <h3>WhatsApp Task</h3>
        <input id="wa-num" type="text" placeholder="88017XXXXXXXX">
        <button onclick="getPairingCode()">Get Pairing Code</button>
        <div id="loading" style="display:none; text-align:center; margin-top:10px;">অপেক্ষা করুন...</div>
        <div class="pairing-code" id="pair-display"></div>
    </div>
</div>

<div id="footer-nav" class="nav" style="display:none;">
    <div onclick="showTab('home-page')">Home</div>
    <div onclick="showTab('task-page')">Task</div>
    <div onclick="location.reload()">Logout</div>
</div>

<script>
    // আপনার Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyDvtZJhIN850tU7cETuiqRyCyjCBdlFt-Y",
        authDomain: "fynora-81313.firebaseapp.com",
        databaseURL: "https://fynora-81313-default-rtdb.firebaseio.com",
        projectId: "fynora-81313",
        storageBucket: "fynora-81313.firebasestorage.app",
        messagingSenderId: "593306264446",
        appId: "1:593306264446:web:da476d4c77ae4ede6b492f",
        measurementId: "G-BX0FWR2YMT"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentUser = null;

    function register() {
        const phone = document.getElementById('phone').value;
        const pass = document.getElementById('pass').value;
        if(!phone || !pass) return alert("সব ঘর পূরণ করুন");

        db.ref('users/' + phone).set({
            phone: phone,
            password: pass,
            balance: 0,
            status: "offline"
        }).then(() => alert("রেজিস্ট্রেশন সফল! এখন লগইন করুন।"));
    }

    function login() {
        const phone = document.getElementById('phone').value;
        const pass = document.getElementById('pass').value;

        db.ref('users/' + phone).once('value', (snapshot) => {
            const data = snapshot.val();
            if(data && data.password === pass) {
                currentUser = phone;
                document.getElementById('u-phone').innerText = phone;
                document.getElementById('u-balance').innerText = data.balance;
                document.getElementById('auth-page').style.display = 'none';
                document.getElementById('footer-nav').style.display = 'flex';
                showTab('home-page');
            } else {
                alert("ভুল তথ্য!");
            }
        });
    }

    async function getPairingCode() {
        const waNum = document.getElementById('wa-num').value;
        const display = document.getElementById('pair-display');
        const loading = document.getElementById('loading');

        loading.style.display = 'block';
        display.innerText = '';

        try {
            const res = await fetch(`/api/get-code?number=${waNum}&userPhone=${currentUser}`);
            const data = await res.json();
            loading.style.display = 'none';
            if(data.code) display.innerText = data.code;
            else alert(data.error);
        } catch(e) { 
            loading.style.display = 'none';
            alert("সার্ভার এরর!"); 
        }
    }

    function showTab(id) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
</script>
</body>
</html>
